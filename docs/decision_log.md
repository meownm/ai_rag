# Decision log

Формат записи: DEC-XXXX | дата | контекст | решение | альтернативы | последствия.

## DEC-0001 | 2026-01-22 | EPIC-01 = инфраструктура и FTS-ready схема БД
**Контекст:** нужно запустить локальную инфраструктуру в закрытом тестовом контуре с минимальным числом ручных действий и подготовить Postgres для полнотекстового поиска.

**Решение:** в EPIC-01 делаем Docker Compose стек (PostgreSQL, MinIO, Redis, Grafana/Prometheus/Loki/Promtail, pgAdmin/Adminer/pgHero) и миграции БД с FTS индексами; семантика и сервисы остаются зарезервированными на следующие эпики.

**Альтернативы:** 
- поднимать инфраструктуру вручную без скриптов;
- добавить сервисы сразу (gateway/search/ingest/admin) в EPIC-01.

**Последствия:** EPIC-01 остаётся стабильным базовым слоем; API-сервисы не блокируют старт инфраструктуры.

## DEC-0002 | 2026-01-22 | reset-no-confirm для локального контура
**Контекст:** требование минимизировать ручные действия при сбросе окружения.

**Решение:** `infra\reset_all.bat` удаляет контейнеры и volumes без подтверждения.

**Альтернативы:** подтверждение в консоли.

**Последствия:** опасная операция; используется только на локальном контуре.

## DEC-0003 | 2026-01-22 | Создание ролей БД из переменных окружения
**Контекст:** нужно автоматически заводить пользователей и права без ручного SQL.

**Решение:** `db-migrator` создаёт/обновляет роли `POSTGRES_APP_USER` и `POSTGRES_READONLY_USER` и выдаёт grants/default privileges.

**Альтернативы:** хранить SQL с паролями в репозитории; создавать роли вручную.

**Последствия:** пароль меняется при каждом запуске мигратора, если изменён в `.env`.

## DEC-0004 | 2026-01-22 | EPIC-01 работает в режиме FTS-only
**Контекст:** текущий эпик зафиксирован как `fts-only`, при этом в инфраструктуре уже предусмотрены заделы под следующие эпики (включая pgvector).

**Решение:** в EPIC-01 реализуется только полнотекстовая часть (tsvector + GIN + trigram), а векторная часть считается зарезервированной: переменная `SEARCH_VECTOR_WEIGHT` выставляется в `0`, а любые будущие компоненты семантического поиска вводятся отдельным эпиком и отдельным решением.

**Альтернативы:**
- убрать `pgvector` и колонку `embedding` из схемы до момента, когда понадобится семантика;
- сразу делать гибрид (FTS + vector) в EPIC-01.

**Последствия:** режим EPIC-01 остаётся однозначным (FTS-only), при этом «задел» не ломает текущую эксплуатацию и не требует пересоздания инфраструктуры при переходе к гибриду.
