# Decision log

Формат записи: DEC-XXXX | дата | контекст | решение | альтернативы | последствия.

## DEC-0001 | 2026-01-22 | EPIC-01 = инфраструктура и FTS-ready схема БД
**Контекст:** нужно запустить локальную инфраструктуру в закрытом тестовом контуре с минимальным числом ручных действий и подготовить Postgres для полнотекстового поиска.

**Решение:** в EPIC-01 делаем Docker Compose стек (PostgreSQL, MinIO, Redis, Grafana/Prometheus/Loki/Promtail, pgAdmin/Adminer/pgHero) и миграции БД с FTS индексами; семантика и сервисы остаются зарезервированными на следующие эпики.

**Альтернативы:** 
- поднимать инфраструктуру вручную без скриптов;
- добавить сервисы сразу (gateway/search/ingest/admin) в EPIC-01.

**Последствия:** EPIC-01 остаётся стабильным базовым слоем; API-сервисы не блокируют старт инфраструктуры.

## DEC-0002 | 2026-01-22 | reset-no-confirm для локального контура
**Контекст:** требование минимизировать ручные действия при сбросе окружения.

**Решение:** `infra\reset_all.bat` удаляет контейнеры и volumes без подтверждения.

**Альтернативы:** подтверждение в консоли.

**Последствия:** опасная операция; используется только на локальном контуре.

## DEC-0003 | 2026-01-22 | Создание ролей БД из переменных окружения
**Контекст:** нужно автоматически заводить пользователей и права без ручного SQL.

**Решение:** `db-migrator` создаёт/обновляет роли `POSTGRES_APP_USER` и `POSTGRES_READONLY_USER` и выдаёт grants/default privileges.

**Альтернативы:** хранить SQL с паролями в репозитории; создавать роли вручную.

**Последствия:** пароль меняется при каждом запуске мигратора, если изменён в `.env`.
